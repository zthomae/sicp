<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>4.69&nbsp;Exercise 4.69</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">zthomae&rsquo;s SICP solutions</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Chapter_1.html" class="tocviewlink" data-pltdoc="x">Chapter 1</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Chapter_2.html" class="tocviewlink" data-pltdoc="x">Chapter 2</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Chapter_3.html" class="tocviewlink" data-pltdoc="x">Chapter 3</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Chapter_4.html" class="tocviewselflink" data-pltdoc="x">Chapter 4</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Chapter_5.html" class="tocviewlink" data-pltdoc="x">Chapter 5</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>4&nbsp;</td><td><a href="Chapter_4.html" class="tocviewlink" data-pltdoc="x">Chapter 4</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">4.1&nbsp;</td><td><a href="c4e1.html" class="tocviewlink" data-pltdoc="x">Exercise 4.1</a></td></tr><tr><td align="right">4.2&nbsp;</td><td><a href="c4e2.html" class="tocviewlink" data-pltdoc="x">Exercise 4.2</a></td></tr><tr><td align="right">4.3&nbsp;</td><td><a href="c4e3.html" class="tocviewlink" data-pltdoc="x">Exercise 4.3</a></td></tr><tr><td align="right">4.4&nbsp;</td><td><a href="c4e4.html" class="tocviewlink" data-pltdoc="x">Exercise 4.4</a></td></tr><tr><td align="right">4.5&nbsp;</td><td><a href="c4e5.html" class="tocviewlink" data-pltdoc="x">Exercise 4.5</a></td></tr><tr><td align="right">4.6&nbsp;</td><td><a href="c4e6.html" class="tocviewlink" data-pltdoc="x">Exercise 4.6</a></td></tr><tr><td align="right">4.7&nbsp;</td><td><a href="c4e7.html" class="tocviewlink" data-pltdoc="x">Exercise 4.7</a></td></tr><tr><td align="right">4.8&nbsp;</td><td><a href="c4e8.html" class="tocviewlink" data-pltdoc="x">Exercise 4.8</a></td></tr><tr><td align="right">4.9&nbsp;</td><td><a href="c4e9.html" class="tocviewlink" data-pltdoc="x">Exercise 4.9</a></td></tr><tr><td align="right">4.10&nbsp;</td><td><a href="c4e10.html" class="tocviewlink" data-pltdoc="x">Exercise 4.10</a></td></tr><tr><td align="right">4.11&nbsp;</td><td><a href="c4e11.html" class="tocviewlink" data-pltdoc="x">Exercise 4.11</a></td></tr><tr><td align="right">4.12&nbsp;</td><td><a href="c4e12.html" class="tocviewlink" data-pltdoc="x">Exercise 4.12</a></td></tr><tr><td align="right">4.13&nbsp;</td><td><a href="c4e13.html" class="tocviewlink" data-pltdoc="x">Exercise 4.13</a></td></tr><tr><td align="right">4.14&nbsp;</td><td><a href="c4e14.html" class="tocviewlink" data-pltdoc="x">Exercise 4.14</a></td></tr><tr><td align="right">4.15&nbsp;</td><td><a href="c4e15.html" class="tocviewlink" data-pltdoc="x">Exercise 4.15</a></td></tr><tr><td align="right">4.16&nbsp;</td><td><a href="c4e16.html" class="tocviewlink" data-pltdoc="x">Exercise 4.16</a></td></tr><tr><td align="right">4.17&nbsp;</td><td><a href="c4e17.html" class="tocviewlink" data-pltdoc="x">Exercise 4.17</a></td></tr><tr><td align="right">4.18&nbsp;</td><td><a href="c4e18.html" class="tocviewlink" data-pltdoc="x">Exercise 4.18</a></td></tr><tr><td align="right">4.19&nbsp;</td><td><a href="c4e19.html" class="tocviewlink" data-pltdoc="x">Exercise 4.19</a></td></tr><tr><td align="right">4.20&nbsp;</td><td><a href="c4e20.html" class="tocviewlink" data-pltdoc="x">Exercise 4.20</a></td></tr><tr><td align="right">4.21&nbsp;</td><td><a href="c4e21.html" class="tocviewlink" data-pltdoc="x">Exercise 4.21</a></td></tr><tr><td align="right">4.22&nbsp;</td><td><a href="c4e22.html" class="tocviewlink" data-pltdoc="x">Exercise 4.22</a></td></tr><tr><td align="right">4.23&nbsp;</td><td><a href="c4e23.html" class="tocviewlink" data-pltdoc="x">Exercise 4.23</a></td></tr><tr><td align="right">4.24&nbsp;</td><td><a href="c4e24.html" class="tocviewlink" data-pltdoc="x">Exercise 4.24</a></td></tr><tr><td align="right">4.25&nbsp;</td><td><a href="c4e25.html" class="tocviewlink" data-pltdoc="x">Exercise 4.25</a></td></tr><tr><td align="right">4.26&nbsp;</td><td><a href="c4e26.html" class="tocviewlink" data-pltdoc="x">Exercise 4.26</a></td></tr><tr><td align="right">4.27&nbsp;</td><td><a href="c4e27.html" class="tocviewlink" data-pltdoc="x">Exercise 4.27</a></td></tr><tr><td align="right">4.28&nbsp;</td><td><a href="c4e28.html" class="tocviewlink" data-pltdoc="x">Exercise 4.28</a></td></tr><tr><td align="right">4.29&nbsp;</td><td><a href="c4e29.html" class="tocviewlink" data-pltdoc="x">Exercise 4.29</a></td></tr><tr><td align="right">4.30&nbsp;</td><td><a href="c4e30.html" class="tocviewlink" data-pltdoc="x">Exercise 4.30</a></td></tr><tr><td align="right">4.31&nbsp;</td><td><a href="c4e31.html" class="tocviewlink" data-pltdoc="x">Exercise 4.31</a></td></tr><tr><td align="right">4.32&nbsp;</td><td><a href="c4e32.html" class="tocviewlink" data-pltdoc="x">Exercise 4.32</a></td></tr><tr><td align="right">4.33&nbsp;</td><td><a href="c4e33.html" class="tocviewlink" data-pltdoc="x">Exercise 4.33</a></td></tr><tr><td align="right">4.34&nbsp;</td><td><a href="c4e34.html" class="tocviewlink" data-pltdoc="x">Exercise 4.34</a></td></tr><tr><td align="right">4.35&nbsp;</td><td><a href="c4e35.html" class="tocviewlink" data-pltdoc="x">Exercise 4.35</a></td></tr><tr><td align="right">4.36&nbsp;</td><td><a href="c4e36.html" class="tocviewlink" data-pltdoc="x">Exercise 4.36</a></td></tr><tr><td align="right">4.37&nbsp;</td><td><a href="c4e37.html" class="tocviewlink" data-pltdoc="x">Exercise 4.37</a></td></tr><tr><td align="right">4.38&nbsp;</td><td><a href="c4e38.html" class="tocviewlink" data-pltdoc="x">Exercise 4.38</a></td></tr><tr><td align="right">4.39&nbsp;</td><td><a href="c4e39.html" class="tocviewlink" data-pltdoc="x">Exercise 4.39</a></td></tr><tr><td align="right">4.40&nbsp;</td><td><a href="c4e40.html" class="tocviewlink" data-pltdoc="x">Exercise 4.40</a></td></tr><tr><td align="right">4.41&nbsp;</td><td><a href="c4e41.html" class="tocviewlink" data-pltdoc="x">Exercise 4.41</a></td></tr><tr><td align="right">4.42&nbsp;</td><td><a href="c4e42.html" class="tocviewlink" data-pltdoc="x">Exercise 4.42</a></td></tr><tr><td align="right">4.43&nbsp;</td><td><a href="c4e43.html" class="tocviewlink" data-pltdoc="x">Exercise 4.43</a></td></tr><tr><td align="right">4.44&nbsp;</td><td><a href="c4e44.html" class="tocviewlink" data-pltdoc="x">Exercise 4.44</a></td></tr><tr><td align="right">4.45&nbsp;</td><td><a href="c4e45.html" class="tocviewlink" data-pltdoc="x">Exercise 4.45</a></td></tr><tr><td align="right">4.46&nbsp;</td><td><a href="c4e46.html" class="tocviewlink" data-pltdoc="x">Exercise 4.46</a></td></tr><tr><td align="right">4.47&nbsp;</td><td><a href="c4e47.html" class="tocviewlink" data-pltdoc="x">Exercise 4.47</a></td></tr><tr><td align="right">4.48&nbsp;</td><td><a href="c4e48.html" class="tocviewlink" data-pltdoc="x">Exercise 4.48</a></td></tr><tr><td align="right">4.49&nbsp;</td><td><a href="c4e49.html" class="tocviewlink" data-pltdoc="x">Exercise 4.49</a></td></tr><tr><td align="right">4.50&nbsp;</td><td><a href="c4e50.html" class="tocviewlink" data-pltdoc="x">Exercise 4.50</a></td></tr><tr><td align="right">4.51&nbsp;</td><td><a href="c4e51.html" class="tocviewlink" data-pltdoc="x">Exercise 4.51</a></td></tr><tr><td align="right">4.52&nbsp;</td><td><a href="c4e52.html" class="tocviewlink" data-pltdoc="x">Exercise 4.52</a></td></tr><tr><td align="right">4.53&nbsp;</td><td><a href="c4e53.html" class="tocviewlink" data-pltdoc="x">Exercise 4.53</a></td></tr><tr><td align="right">4.54&nbsp;</td><td><a href="c4e54.html" class="tocviewlink" data-pltdoc="x">Exercise 4.54</a></td></tr><tr><td align="right">4.55&nbsp;</td><td><a href="c4e55.html" class="tocviewlink" data-pltdoc="x">Exercise 4.55</a></td></tr><tr><td align="right">4.56&nbsp;</td><td><a href="c4e56.html" class="tocviewlink" data-pltdoc="x">Exercise 4.56</a></td></tr><tr><td align="right">4.57&nbsp;</td><td><a href="c4e57.html" class="tocviewlink" data-pltdoc="x">Exercise 4.57</a></td></tr><tr><td align="right">4.58&nbsp;</td><td><a href="c4e58.html" class="tocviewlink" data-pltdoc="x">Exercise 4.58</a></td></tr><tr><td align="right">4.59&nbsp;</td><td><a href="c4e59.html" class="tocviewlink" data-pltdoc="x">Exercise 4.59</a></td></tr><tr><td align="right">4.60&nbsp;</td><td><a href="c4e60.html" class="tocviewlink" data-pltdoc="x">Exercise 4.60</a></td></tr><tr><td align="right">4.61&nbsp;</td><td><a href="c4e61.html" class="tocviewlink" data-pltdoc="x">Exercise 4.61</a></td></tr><tr><td align="right">4.62&nbsp;</td><td><a href="c4e62.html" class="tocviewlink" data-pltdoc="x">Exercise 4.62</a></td></tr><tr><td align="right">4.63&nbsp;</td><td><a href="c4e63.html" class="tocviewlink" data-pltdoc="x">Exercise 4.63</a></td></tr><tr><td align="right">4.64&nbsp;</td><td><a href="c4e64.html" class="tocviewlink" data-pltdoc="x">Exercise 4.64</a></td></tr><tr><td align="right">4.65&nbsp;</td><td><a href="c4e65.html" class="tocviewlink" data-pltdoc="x">Exercise 4.65</a></td></tr><tr><td align="right">4.66&nbsp;</td><td><a href="c4e66.html" class="tocviewlink" data-pltdoc="x">Exercise 4.66</a></td></tr><tr><td align="right">4.67&nbsp;</td><td><a href="c4e67.html" class="tocviewlink" data-pltdoc="x">Exercise 4.67</a></td></tr><tr><td align="right">4.68&nbsp;</td><td><a href="c4e68.html" class="tocviewlink" data-pltdoc="x">Exercise 4.68</a></td></tr><tr><td align="right">4.69&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Exercise 4.69</a></td></tr><tr><td align="right">4.70&nbsp;</td><td><a href="c4e70.html" class="tocviewlink" data-pltdoc="x">Exercise 4.70</a></td></tr><tr><td align="right">4.71&nbsp;</td><td><a href="c4e71.html" class="tocviewlink" data-pltdoc="x">Exercise 4.71</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="c4e68.html" title="backward to &quot;4.68 Exercise 4.68&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Chapter_4.html" title="up to &quot;4 Chapter 4&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="c4e70.html" title="forward to &quot;4.70 Exercise 4.70&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>4.69<tt>&nbsp;</tt><a name="(part._c4e69)"></a>Exercise 4.69</h4><p>This problem is trickier than it appears. At its most basic
level, it&rsquo;s clear that the answer involves recursively
unwrapping lists of the form <span class="stt">(great great
... grandson)</span>, using each appearance of <span class="stt">great</span> to
descend another <span class="stt">son</span> relationship and verify that the
rest of the relationship list holds for the son and the
original descendant of the relationship.</p><p>The first trick is provided: You have to make sure that the
relationship you are modifying with <span class="stt">great</span> can actually
be modified in the first place. Hence the book&rsquo;s
recommendation of a rule that determines whether a list ends
with "grandson".</p><p>With all of this in mind, you might expect to be able to
write something like this:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">rule</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">great</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">?rel</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">?x</span><span class="hspace">&nbsp;</span><span class="RktSym">?desc</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">son</span><span class="hspace">&nbsp;</span><span class="RktSym">?x</span><span class="hspace">&nbsp;</span><span class="RktSym">?y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?rel</span><span class="hspace">&nbsp;</span><span class="RktSym">?y</span><span class="hspace">&nbsp;</span><span class="RktSym">?desc</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ends-with-grandson</span><span class="hspace">&nbsp;</span><span class="RktSym">?rel</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>However, there is a subtle problem with this: if <span class="stt">?rel</span>
is a <span style="font-style: italic">ending with grandson</span>, then we will eventually
attempt to verify an expression like <span class="stt">((grandson) Adam
Enoch)</span>, which will not match. What <span style="font-style: italic">could</span> be
generated and pass the <span class="stt">(?rel ?y ?desc)</span> condition is an
atomic value from an improper list, such as <span class="stt">(great
. grandson)</span>. If you allow the list to be improper, you
could get all of the correct relationships out, but I would
prefer to state the rules cleanly.</p><p>There is also a subtle danger that the previous example
avoids. It seems important to evaluate conditions such as
<span class="stt">ends-with-grandson</span> after using other rules to generate
relationships. In my experience, trying to evaluate these
structural rules earlier will result in matches not being
produced if you try to generate the relationship itself, e.g.
with <span class="stt">(?rel Adam ?x)</span>.</p><p>I&rsquo;d also like to point out a potential problem that we could
exacerbate by trying to fix the rule above. Suppose we wrote a
matching rule more like this:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">and</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equal</span><span class="hspace">&nbsp;</span><span class="RktSym">?rel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">grandson</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">grandson</span><span class="hspace">&nbsp;</span><span class="RktSym">?y</span><span class="hspace">&nbsp;</span><span class="RktSym">?desc</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Something like this could allow you to extract the only
element of a list and verify that the relationship
holds. But consider what happens if we try to add daughters
to our relationship graph.  This rule will no longer work,
because it only allows you to find grandsons, and not
granddaughters. The suggestion to verify that a list ends
with grandson can be taken a bit too literally. Instead, we
want a rule to determine whether a relationship is modifiable
by "great":</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">rule</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">great-modifiable</span><span class="hspace">&nbsp;</span><span class="RktSym">grandson</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>You could add another case to allow granddaughter to be
great-modifiable as well later on. And if you use this when
you define the rule for matching on great- relationships,
you don&rsquo;t need to modify a more complex existing rule in the
face of new data.</p><p>With all that stated, these are the rules I came up with
that match these relationships correctly, and that seem to
be correct for arbitrary queries:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">assert!</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rule</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">great-modifiable</span><span class="hspace">&nbsp;</span><span class="RktSym">grandson</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">assert!</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rule</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">nil</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">assert!</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rule</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">great</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">?r</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">?rs</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">?x</span><span class="hspace">&nbsp;</span><span class="RktSym">?desc</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">son</span><span class="hspace">&nbsp;</span><span class="RktSym">?x</span><span class="hspace">&nbsp;</span><span class="RktSym">?y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?r</span><span class="hspace">&nbsp;</span><span class="RktSym">?y</span><span class="hspace">&nbsp;</span><span class="RktSym">?desc</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">great-modifiable</span><span class="hspace">&nbsp;</span><span class="RktSym">?r</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">nil</span><span class="hspace">&nbsp;</span><span class="RktSym">?rs</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">?r</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">?rs</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">?y</span><span class="hspace">&nbsp;</span><span class="RktSym">?desc</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">not</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">nil</span><span class="hspace">&nbsp;</span><span class="RktSym">?rs</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Here are some of the queries that work successfully:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">;;; Query input:</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Adam ?x)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query output:</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Adam Irad)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query input:</span></p></td></tr><tr><td><p><span class="stt">((great grandson) ?x Irad)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query output:</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Adam Irad)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query input:</span></p></td></tr><tr><td><p><span class="stt">((great great ?x) Adam ?y)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query output:</span></p></td></tr><tr><td><p><span class="stt">((great great grandson) Adam Mehujael)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query input:</span></p></td></tr><tr><td><p><span class="stt">((great great . ?x) Adam ?y)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query output:</span></p></td></tr><tr><td><p><span class="stt">((great great grandson) Adam Mehujael)</span></p></td></tr><tr><td><p><span class="stt">((great great great grandson) Adam Methushael)</span></p></td></tr><tr><td><p><span class="stt">((great great great great grandson) Adam Lamech)</span></p></td></tr><tr><td><p><span class="stt">((great great great great great grandson) Adam Jubal)</span></p></td></tr><tr><td><p><span class="stt">((great great great great great grandson) Adam Jabal)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query input:</span></p></td></tr><tr><td><p><span class="stt">(?rel Adam ?x)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query output:</span></p></td></tr><tr><td><p><span class="stt">(son Adam Cain)</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Adam Irad)</span></p></td></tr><tr><td><p><span class="stt">(grandson Adam Enoch)</span></p></td></tr><tr><td><p><span class="stt">((great great grandson) Adam Mehujael)</span></p></td></tr><tr><td><p><span class="stt">((great great great grandson) Adam Methushael)</span></p></td></tr><tr><td><p><span class="stt">((great great great great grandson) Adam Lamech)</span></p></td></tr><tr><td><p><span class="stt">((great great great great great grandson) Adam Jubal)</span></p></td></tr><tr><td><p><span class="stt">((great great great great great grandson) Adam Jabal)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query input:</span></p></td></tr><tr><td><p><span class="stt">(?rel ?x ?y)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">;;; Query output:</span></p></td></tr><tr><td><p><span class="stt">(son Ada Jubal)</span></p></td></tr><tr><td><p><span class="stt">(son Ada Jabal)</span></p></td></tr><tr><td><p><span class="stt">(wife Lamech Ada)</span></p></td></tr><tr><td><p><span class="stt">(son Methushael Lamech)</span></p></td></tr><tr><td><p><span class="stt">(son Mehujael Methushael)</span></p></td></tr><tr><td><p><span class="stt">(son Irad Mehujael)</span></p></td></tr><tr><td><p><span class="stt">(son Enoch Irad)</span></p></td></tr><tr><td><p><span class="stt">(son Cain Enoch)</span></p></td></tr><tr><td><p><span class="stt">(son Adam Cain)</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Mehujael Jubal)</span></p></td></tr><tr><td><p><span class="stt">(son Lamech Jubal)</span></p></td></tr><tr><td><p><span class="stt">((great great grandson) Irad Jubal)</span></p></td></tr><tr><td><p><span class="stt">(grandson Methushael Jubal)</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Mehujael Jabal)</span></p></td></tr><tr><td><p><span class="stt">(son Lamech Jabal)</span></p></td></tr><tr><td><p><span class="stt">((great great grandson) Enoch Lamech)</span></p></td></tr><tr><td><p><span class="stt">(grandson Mehujael Lamech)</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Irad Lamech)</span></p></td></tr><tr><td><p><span class="stt">(grandson Methushael Jabal)</span></p></td></tr><tr><td><p><span class="stt">((great great grandson) Irad Jabal)</span></p></td></tr><tr><td><p><span class="stt">(grandson Irad Methushael)</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Enoch Methushael)</span></p></td></tr><tr><td><p><span class="stt">(grandson Enoch Mehujael)</span></p></td></tr><tr><td><p><span class="stt">((great great grandson) Cain Methushael)</span></p></td></tr><tr><td><p><span class="stt">(grandson Cain Irad)</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Cain Mehujael)</span></p></td></tr><tr><td><p><span class="stt">(grandson Adam Enoch)</span></p></td></tr><tr><td><p><span class="stt">((great great great grandson) Enoch Jubal)</span></p></td></tr><tr><td><p><span class="stt">((great grandson) Adam Irad)</span></p></td></tr><tr><td><p><span class="stt">((great great grandson) Adam Mehujael)</span></p></td></tr><tr><td><p><span class="stt">((great great great grandson) Enoch Jabal)</span></p></td></tr><tr><td><p><span class="stt">((great great great grandson) Cain Lamech)</span></p></td></tr><tr><td><p><span class="stt">((great great great grandson) Adam Methushael)</span></p></td></tr><tr><td><p><span class="stt">((great great great great grandson) Cain Jubal)</span></p></td></tr><tr><td><p><span class="stt">((great great great great grandson) Adam Lamech)</span></p></td></tr><tr><td><p><span class="stt">((great great great great grandson) Cain Jabal)</span></p></td></tr><tr><td><p><span class="stt">((great great great great great grandson) Adam Jubal)</span></p></td></tr><tr><td><p><span class="stt">((great great great great great grandson) Adam Jabal)</span></p></td></tr></table></p><p>I don&rsquo;t think I have the cleanest expression of the rule,
but I&rsquo;m reasonably confident that it&rsquo;s correct. And it
avoids repeatedly checking that lists end with grandson (or
what have you) at every level of recursion, which seems to
me like an inelegance caused by an improperly-expressed rule.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="c4e68.html" title="backward to &quot;4.68 Exercise 4.68&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Chapter_4.html" title="up to &quot;4 Chapter 4&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="c4e70.html" title="forward to &quot;4.70 Exercise 4.70&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>